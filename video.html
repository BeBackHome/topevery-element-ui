<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>
        湖南高速路桥智能管理平台
    </title>
    <style>
        .TUI-toolbar-btn .TUI-ico,
        .TUI-link-btn .TUI-ico {
            margin-top: 3px !important;
        }

        /*-160px -1760px*/
        .TUI-ico-drop {
            background-image: url('/TopeveryDevelopmentUI/img/base_v2/skin/grey/toolbar-ico.png');
            background-position: -160px -1760px;
            background-repeat: no-repeat;
            cursor: pointer;
        }

        .TUI-ico-plus {
            background-image: url('/TopeveryDevelopmentUI/img/base_v2/skin/grey/toolbar-ico.png');
            background-position: 0 -1760px;
            background-repeat: no-repeat;
            cursor: pointer;
        }

        .video-btn-turn-noevent {
            width: 95px;
            height: 95px;
            background: url(/TopeveryDevelopmentUI/img/base_v2/public/videocontrol/turn.png) no-repeat;
            display: block;
            overflow: hidden;
            text-indent: -9999px;
            position: absolute;
            left: 50%;
            top: 50%;
            z-index: 8;
            margin: -49px 0 0 -48px;
        }
    </style>


    <link type="text/css" rel="Stylesheet" media="ALL"
        href="/TopeveryDevelopmentUI/css/base_v2/reset.css?Version=2001061827525202" charset="utf-8" />
    <link type="text/css" rel="Stylesheet" media="ALL"
        href="/TopeveryDevelopmentUI/css/base_v2/style.css?Version=2001061827525202" charset="utf-8" />
    <link type="text/css" rel="Stylesheet" media="ALL"
        href="/TopeveryDevelopmentUI/css/base_v2/skin/ocean/ocean.css?Version=2001061827525202" charset="utf-8" />
    <link type="text/css" rel="Stylesheet" media="ALL" href="/hn.luqiao/css/base.css?Version=2001061827525202"
        charset="utf-8" />
    <link type="text/css" rel="Stylesheet" media="ALL"
        href="/TopeveryDevelopmentUI/css/jqGrid/ui.jqgrid.css?Version=2001061827525202" charset="utf-8" />
    <link type="text/css" rel="Stylesheet" media="ALL"
        href="/TopeveryDevelopmentUI/css/base_v2/skin/ocean/ui.jqgrid.css?Version=2001061827525202" charset="utf-8" />
    <link type="text/css" rel="Stylesheet" media="ALL"
        href="/TopeveryDevelopmentUI/css/base_v2/skin/ocean/my97.css?Version=2001061827525202" charset="utf-8" />
    <link type="text/css" rel="Stylesheet" media="ALL" href="/hn.luqiao/css/lzum/style.css?Version=2001061827525202"
        charset="utf-8" />
    <script type="text/javascript" src="/TopeveryDevelopmentUI/js/jquery-1.7.min.js?Version=2001061827525202"
        charset="utf-8"></script>
    <script type="text/javascript" src="/TopeveryDevelopmentUI/js/base_v2/topevery.ui.base.js?Version=2001061827525202"
        charset="utf-8"></script>
    <script type="text/javascript" src="/TopeveryDevelopmentUI/js/uiLayout/jquery-ui-latest.js?Version=2001061827525202"
        charset="utf-8"></script>
    <script type="text/javascript"
        src="/TopeveryDevelopmentUI/js/uiLayout/jquery.layout-latest.js?Version=2001061827525202"
        charset="utf-8"></script>
    <script type="text/javascript" src="/hn.luqiao/js/base.js?Version=2001061827525202" charset="utf-8"></script>
    <script type="text/javascript" src="/hn.luqiao/js/common.js?Version=2001061827525202" charset="utf-8"></script>
    <script type="text/javascript" src="/hn.luqiao/js/map.setting.js?Version=2001061827525202" charset="utf-8"></script>
    <script type="text/javascript" src="/hn.luqiao/js/jquery.cookie.js?Version=2001061827525202"
        charset="utf-8"></script>
    <script type="text/javascript" src="/hn.luqiao/js/jquery.jqGrid.locale-cn.js?Version=2001061827525202"
        charset="utf-8"></script>
    <script type="text/javascript" src="/hn.luqiao/js/jquery.jqGrid.min.js?Version=2001061827525202"
        charset="utf-8"></script>
    <script type="text/javascript" src="/hn.luqiao/js/jq.framebox.js?Version=2001061827525202" charset="utf-8"></script>
    <script type="text/javascript" src="/hn.luqiao/js/jq.menu.js?Version=2001061827525202" charset="utf-8"></script>
    <script type="text/javascript" src="/hn.luqiao/js/DivLoadClose.js?Version=2001061827525202"
        charset="utf-8"></script>

</head>

<body>
    <script src="../../js/byskplayer.js"></script>
    <form name="form1" method="post"
        action="./VideoMonitoringNew.aspx?carId=26&amp;carNo=%u6e58A866CZ&amp;clientKey=14000151963" id="form1">
        <div>
            <input type="hidden" name="Topevery.ViewState" id="Topevery.ViewState"
                value="785b6c156f7a4669b28561e6fbc3a897" />
            <input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="" />
        </div>

        <div style="height: 757px;">
            <div style="width: 80%; margin: 0 auto 0 auto; line-height: 2.0;padding-top: 30px;">
                <h1>视频控制
                </h1>
            </div>
            <div class="TUI-container" style="width: 80%; height: 80%; margin: 0 auto 0 auto; position: relative;">
                <!-- TUI-layout-north 页面上部(标题部分)  -->
                <div class="TUI-layout-north">
                    <div class="TUI-title">
                        <span class="TUI-ico ico-note"></span><strong>监控平台</strong>
                    </div>
                </div>
                <!-- TUI-layout-center 页面中部(内容部分)  -->
                <div class="TUI-layout-center" id="mainContent">
                    <div class="ui-layout-center video-main" id="videoArea">
                        <div class="TUI-layout-center video-area" id="MMVideo" style="padding:3px;">
                            <!-- 视频播放区域 -->
                        </div>
                        <div class="TUI-layout-north">
                            <div class="video-main-title" style="top:6px !important;">
                                <strong>当前视频源名称：湘A866CZ</strong>
                            </div>
                            <div class="TUI-toolbar">
                                <div class="fl-right">
                                    <ul class="pr10px">
                                        <li class="TUI-only-ico"><a hidefocus="true" data-fun="play"
                                                class="TUI-toolbar-btn" href="javascript:void(0);" title="播放">
                                                <span class="TUI-ico ico-play"></span></a></li>
                                        <li class="TUI-only-ico"><a hidefocus="true" data-fun="stop"
                                                class="TUI-toolbar-btn" href="javascript:void(0);" title="停止">
                                                <span class="TUI-ico ico-stop"></span></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-layout-east">
                        <div class="TUI-tab-right-layout" id="tabbox">
                            <div class="TUI-tab-content TUI-of-auto relative">
                                <!-- 容器内容  -->
                                <div class="TUI-group-box video-control-group" style="height: 98%;">
                                    <div class="TUI-group-item" style="height: 100%;">
                                        <div class="TUI-group-head" style="color: #000;">
                                            <strong>云台控制</strong>
                                        </div>
                                        <div class="TUI-group-content video-play-grey-bg pt10px pb10px"
                                            style="height: 92%;">
                                            <div class="video-play-control mg-auto">
                                                <a href="#" data-type="1" data-param="1" data-fun="wt"
                                                    class="video-btn btn-wt">向上移动</a>
                                                <a href="#" data-type="1" data-param="4"
                                                    class="video-btn btn-wr">向右移动</a>
                                                <a href="#" data-type="1" data-param="2"
                                                    class="video-btn btn-wb">向下移动</a>
                                                <a href="#" data-type="1" data-param="3"
                                                    class="video-btn btn-wl">向左移动</a>
                                                <div class="video-btn btn-wtr"></div>
                                                <div class="video-btn btn-wbr"></div>
                                                <div class="video-btn btn-wbl"></div>
                                                <div class="video-btn btn-wtl"></div>
                                                <div class="video-btn-turn-noevent"></div>
                                            </div>
                                            <div class="mt5px">
                                                <span class="TUI-btn-tinkerup">
                                                    <a href="#" data-type="2" data-param="1"
                                                        class="TUI-toolbar-btn"><span
                                                            class="TUI-ico TUI-ico-drop ico-plus"
                                                            style="margin-top:-2px !important;"></span></a>
                                                    <strong>焦距</strong>
                                                    <a href="#" data-type="2" data-param="0"
                                                        class="TUI-toolbar-btn"><span
                                                            class="TUI-ico TUI-ico-plus ico-minus"
                                                            style="margin-top:-2px !important;"></span></a>
                                                </span>
                                            </div>
                                            <div class="mt5px">
                                                <span class="TUI-btn-tinkerup">
                                                    <a href="#" data-type="3" data-param="1"
                                                        class="TUI-toolbar-btn"><span
                                                            class="TUI-ico TUI-ico-drop ico-plus"
                                                            style="margin-top:-2px !important;"></span></a>
                                                    <strong>光圈</strong>
                                                    <a href="#" data-type="3" data-param="0"
                                                        class="TUI-toolbar-btn"><span
                                                            class="TUI-ico TUI-ico-plus ico-minus"
                                                            style="margin-top:-2px !important;"></span></a>
                                                </span>
                                            </div>
                                            <div class="mt5px">
                                                <span class="TUI-btn-tinkerup">
                                                    <a href="#" data-type="6" data-param="1"
                                                        class="TUI-toolbar-btn"><span
                                                            class="TUI-ico TUI-ico-drop ico-plus"
                                                            style="margin-top:-2px !important;"></span></a>
                                                    <strong>变倍</strong>
                                                    <a href="#" data-type="6" data-param="0"
                                                        class="TUI-toolbar-btn"><span
                                                            class="TUI-ico TUI-ico-plus ico-minus"
                                                            style="margin-top:-2px !important;"></span></a>
                                                </span>
                                            </div>
                                            <div class="mt5px" style="margin-left:25px;">
                                                <strong>雨刷：</strong>
                                                <input type="checkbox" data-type="4" />
                                            </div>
                                            <div class="mt5px" style="margin-left:25px;">
                                                <strong>补光：</strong>
                                                <input type="checkbox" data-type="5" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript" language="javascript">
            //var url = window.location.href;
            //if (url.split('https').length > 1) {
            //    window.location.href = window.location.href.replace(/https/,"http");
            //}
            var CarName = '湘A866CZ';
            $(document).ready(function () {
                TUILayout(".TUI-container");
                /* 创建布局 */
                var myLayout = $("#mainContent").layout({
                    fxName: "slide"                         //fxName                        窗体隐藏显示的动画效果
                    , fxSpeed: "slow"                       //fxSpeed                       动画效果的显示时间/速度
                    , maskIframesOnResize: true             //maskIframesOnResize           页面中存在Iframe对象时，设为true
                    , closable: true                        //closable                      是否允许隐藏打开窗体,true为允许
                    , east__size: "192"                     //west__size                    为调整西边窗体的宽度
                    , resizable: true                       //resizable                     是否允许调整窗体的高/宽, true为允许
                    , slidable: true                        //slidable                      是否允许窗体隐藏后可以滑动预览
                    , north__fxName: "slide"                 //north__fxName                 北边窗体隐藏显示的动画效果
                    , south__fxName: "slide"                 //south__fxName                 南边窗体隐藏显示的动画效果
                    , spacing_closed: 7                     //spacing_closed                隐藏后的间隔栏高宽
                    , spacing_open: 7                       //spacing_open                  显示后的间隔栏高宽
                    , initClosed: false                     //initClosed                    窗体创建后默认隐藏所有窗体
                    , resizerTip: "调整内容宽度"            //resizerTip                    鼠标移上调整窗体栏所显示的文字提醒
                    , resizerDragOpacity: "0.8"             //resizerDragOpacity            鼠标调整窗体栏显示显示的透明度效果
                    , sliderTip: "展开"                     //sliderTip                     鼠标移上滑动隐藏窗体栏所显示的文字提醒
                    , togglerTip_open: "隐藏"               //togglerTip_open               鼠标移上打开的窗体按钮文字提醒
                    , togglerTip_closed: "展开"             //togglerTip_closed             鼠标移上关闭的窗体按钮文字提醒
                    //, east__showOverflowOnHover: true
                    //, center__showOverflowOnHover: true
                });

                TUITabLayout("#tabbox");

                TUILayout("#videoArea");
                /* 工具栏 带弹出层的按钮  */
                popLayer(".toggle-button");

                videoHelper.load({ carNo: "湘AF1221", carKey: "13302441342" });

                bindEvent();
            });

            function bindEvent() {
                $.ajax({
                    url: "http://120.77.112.76:6809/deviceData/vehicleBaseInfo.do?Parameters",
                    type: "post",
                    data: { key: "34143d14-fc4a-4218-b250-a86cd4b9a15a", type: 1 },
                    success: function (data) {
                        var carInfo = undefined;
                        for (let index in data.obj) {
                            if (data.obj[index].plate == CarName) {
                                carInfo = data.obj[index];
                            }
                        }
                        if (carInfo != undefined) {
                            control_direction(carInfo);
                            control_option(carInfo);
                        } else {
                            alert("该车辆暂时没有视频信息");
                        }
                    }
                });
            }

            function control_direction(carInfo) {
                var carId = carInfo.id;
                $(".video-play-control").find("a").click(function () {
                    var data_type = $(this).attr("data-type");
                    var data_param = $(this).attr("data-param");
                    AjaxData(carId, data_type, data_param);
                });
                $(".TUI-group-content").find("input").click(function () {
                    var data_type = $(this).attr("data-type");
                    var data_param = this.checked ? 1 : 0;
                    AjaxData(carId, data_type, data_param);
                });
            }

            function AjaxData(carId, data_type, data_param) {
                var param = {
                    key: "34143d14-fc4a-4218-b250-a86cd4b9a15a",
                    id: carId,
                    name: "视频云台控制",
                    channel: 1,
                    ptzType: 1,
                    param1: 1,
                    param2: 251
                };
                param.ptzType = data_type;
                param.param1 = data_param;
                $.ajax({
                    url: "http://120.77.112.76:6809/ptzController/directive.do",
                    type: "get",
                    data: param,
                    success: function (data) {

                    }
                });
            }

            function control_option(carInfo) {
                var carId = carInfo.id;
                $(".TUI-btn-tinkerup").find("a").click(function () {
                    var data_type = $(this).attr("data-type");
                    var data_param = $(this).attr("data-param");
                    AjaxData(carId, data_type, data_param);
                });
            }

            var videoHelper = (function () {
                var server = {
                    _video: null,
                    playList: [],
                    data: { videoData: null, channel: 1 },
                    ids: null,
                    init: function (opts) {
                        opts = $.extend({ id: 'MMVideo', url: 'wss://videostream.car900.com/', key: '2161e23a-4d3b-4d1a-bf0a-cafd56f9c6f8' }, opts || {});
                        this.event(opts);
                        if (this._video) {
                            this.control.destroy();
                        }
                        this._video = new byskplayer({
                            id: opts.id,
                            isLive: true,
                            userId: 'apidemo',
                            userkey: opts.key,
                            baseURL: opts.url,
                            click: this.control.videoClick
                        });
                        this._video.poster = ' ';
                        this._video.setPlayerNum(1);
                        this.control.loadVideoChannel("1");
                    },
                    load: function (opts) {
                        this.init(opts);
                    },
                    event: function (opts) {
                        $(".TUI-only-ico").find("a").click(function () {
                            server.data.videoData = { tid: server.ids[0], device: opts.carKey, channel: 1 };
                            var func = $(this).attr("data-fun");
                            var videofuc = function () {
                                if (func === "stop") {
                                    this.control.stop.call(func, opts.carKey, "1");
                                }
                                else {
                                    this.control.play.call(func, opts.carNo, opts.carKey, "1");
                                }
                            };
                            videofuc.call(server);
                        });
                    },
                    control: {
                        loadVideoChannel: function (channel) {
                            var channelArr = channel.split(',');
                            var tidObj = server._video.allocate(channelArr.length); //根据通道数申请
                            server.ids = tidObj.ids;
                            if (tidObj.flag !== 1) {
                                //申请失败
                                alert(obj.msg);
                            }
                        },
                        play: function (carNo, deviceNo, chn) {
                            var device = Number(deviceNo);
                            var channel = chn;
                            var obj = server.playList.find(p => p.params && p.params.device === device && p.params.channel === channel);
                            if (obj) {
                                return;
                            } //已经在播放的则不能再播放
                            if (server.data.videoData) {
                                var tid = server.data.videoData.tid;
                                var param = {
                                    device: device, //终端号
                                    channel: server.data.videoData.channel, //通道号 （1~8）
                                    protocolType: 1, //协议类型，1：GF-1078，2：GA系列
                                    plate: carNo //车牌号（可选）
                                };
                                server._video.real.open(tid,
                                    param,
                                    res => {
                                        //alert(res);
                                    });
                                server.playList.push({ tid: tid, params: param });
                            } else {
                                alert("请先选择播放的窗口！");
                            }
                        },
                        stop: function (deviceNo, chn) {
                            var device = Number(deviceNo);
                            if (server.data.videoData) {
                                var tid = server.data.videoData.tid;
                                server._video.real.close(tid, {
                                    device: device,
                                    channel: server.data.videoData.channel,
                                    protocolType: 1
                                }, res => {
                                });
                                var index = server.playList.findIndex(p => p.params && p.params.device === device && p.params.channel === server.data.videoData.channel);
                                server.playList.splice(index, 1);
                            } else {
                                alert("请先选择播放的窗口！");
                            }
                        },
                        setWinNum: function (num) {
                            server._video.setPlayerNum(num);
                        },
                        destroy: function () {
                            if (server._video.player) {
                                server._video.destroy();
                            }
                            server._video.player = null;
                            server.playList = [];
                        },
                        videoClick: function (obj) {
                            //alert(1);
                            //debugger
                            //server.data.videoData = { tid: obj.tid, device: obj.device, channel: server.data.channel };
                            //if (server.data.channel >= 4) {
                            //    server.data.channel = 1;
                            //} else {
                            //    server.data.channel++;
                            //}
                        }
                    },
                    video: {
                        real: {
                            open: function (carNo, deviceNo, chn) {
                                var device = Number(deviceNo);
                                var channel = chn;
                                var obj = server.playList.find(p => p.params && p.params.device === device && p.params.channel === channel);
                                if (obj) {
                                    return;
                                } //已经在播放的则不能再播放
                                if (server.data.videoData) {
                                    var tid = server.data.videoData.tid;
                                    var param = {
                                        device: device, //终端号
                                        channel: server.data.videoData.channel, //通道号 （1~8）
                                        protocolType: 1, //协议类型，1：GF-1078，2：GA系列
                                        plate: carNo //车牌号（可选）
                                    };
                                    server._video.real.open(tid,
                                        param,
                                        function (res) { });
                                    server.playList.push({ tid: tid, params: param });
                                } else {
                                    alert("请先选择播放的窗口！");
                                }
                            },
                            close: function (deviceNo, chn) {
                                var device = Number(deviceNo);
                                if (server.data.videoData) {
                                    var tid = server.data.videoData.tid;
                                    server._video.real.close(tid, {
                                        device: device,
                                        channel: server.data.videoData.channel,
                                        protocolType: 1
                                    }, function (res) { });
                                    var index = server.playList.findIndex(p => p.params && p.params.device === device && p.params.channel === server.data.videoData.channel);
                                    server.playList.splice(index, 1);
                                } else {
                                    alert("请先选择播放的窗口！");
                                }
                            },
                            openSpeak: function () {

                            },
                            closeSpeak: function () {

                            }
                        },
                        record: {
                            query: function (deviceNo, chn, beginDate, endDate) {
                                var device = Number(deviceNo);
                                var param = {
                                    device: device, //终端号
                                    channel: chn, //通道号 （1~8）
                                    protocolType: 1, //协议类型，1：GF-1078，2：GA系列
                                    begintime: beginDate,
                                    endtime: endDate
                                };
                                server._video.record.query(param, function (res) {
                                    if (res.status === 1) {
                                        var totalNum = res.records;
                                        $(res.recordfiles).each(function () {

                                        });
                                    } else {
                                        alert(res.info);
                                    }
                                });
                            },
                            open: function (carNo, deviceNo, chn, beginDate, endDate) {
                                var device = Number(deviceNo);
                                var channel = chn;
                                var obj = server.playList.find(p => p.params && p.params.device === device && p.params.channel === channel);
                                if (obj) {
                                    return;
                                } //已经在播放的则不能再播放
                                if (server.data.videoData) {
                                    var tid = server.data.videoData.tid;
                                    var param = {
                                        device: device, //终端号
                                        channel: server.data.videoData.channel, //通道号 （1~8）
                                        protocolType: 1, //协议类型，1：GF-1078，2：GA系列
                                        begintime: beginDate,
                                        endtime: endDate,
                                        plate: carNo //车牌号（可选）
                                    };
                                    server._video.record.open(tid, param, function (res) {
                                        if (res.status === 1) {

                                        } else {
                                            alert(res.info);
                                        }
                                    });
                                    server.playList.push({ tid: tid, params: param });
                                } else {
                                    alert("请先选择播放的窗口！");
                                }
                            },
                            close: function (deviceNo) {
                                var device = Number(deviceNo);
                                if (server.data.videoData) {
                                    var tid = server.data.videoData.tid;
                                    server._video.real.close(tid,
                                        {
                                            device: device,
                                            channel: server.data.videoData.channel,
                                            protocolType: 1
                                        },
                                        function (res) {
                                            if (res.status === 1) {
                                                var index = server.playList.findIndex(p => p.params &&
                                                    p.params.device === device &&
                                                    p.params.channel === server.data.videoData.channel);
                                                server.playList.splice(index, 1);
                                            } else {
                                                alert(res.info);
                                            }
                                        });

                                } else {
                                    alert("请先选择播放的窗口！");
                                }
                            }
                        },
                        ftp: {},
                        gaDownload: {}
                    }
                };

                return {
                    load: function (opts) {
                        server.load(opts);
                    }
                }
            })();
        </script>
    </form>
</body>

</html>